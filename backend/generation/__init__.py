# generation/__init__.py
"""
AIHUB(전문 의학지식 데이터,필수의료 의학지식 데이터) 기반 동적 의료 문제 생성 시스템
=============================================

이 패키지는 벡터DB 검색과 LLM을 활용하여 한국 의사국가고시 스타일의 
의료 문제를 자동 생성하는 시스템입니다.

주요 특징:
---------
🎯 동적 문제 생성: 사용자 쿼리 → 벡터 검색 → LLM 자율 판단 → 문제 생성
🖼️ **실제 X-ray 이미지 자동 표시**: 8개 흉부 질병은 문제와 함께 실제 의료 영상 출력
🤖 스마트 이미지 선택: LLM이 문제 내용을 분석하여 적절한 X-ray 이미지 자동 선택
📝 텍스트 전용 지원: 흉부와 무관한 의료 주제는 이미지 없이 텍스트만으로 처리
🔍 확장 가능한 검색: 8개 흉부 질병 + 일반 의료 분야 모두 지원

지원 의료 분야:
--------------
🩺 **X-ray 이미지 포함 질환** (실제 의료 영상과 함께 문제 출력):
   ✅ Pneumonia (폐렴) - 23개 영상 보유
   ✅ Effusion (흉수) - 51개 영상 보유  
   ✅ Mass (종괴) - 22개 영상 보유
   ✅ Nodule (결절) - 3개 영상 보유
   ✅ Pneumothorax (기흉) - 12개 영상 보유
   ✅ Atelectasis (무기폐) - 31개 영상 보유
   ✅ Infiltrate (침윤/경화) - 44개 영상 보유
   ✅ Cardiomegaly (심장비대) - 11개 영상 보유

📝 **텍스트 전용 질환** (이미지 없이 문제만 출력):
   ✅ 내과: 당뇨병, 고혈압, 신장질환, 간질환, 내분비 등
   ✅ 외과: 열상, 골절, 충수염, 탈장, 화상 등  
   ✅ 소아과: 소아 재활, 성장 발달, 예방접종 등
   ✅ 기타: 응급의학, 정형외과, 피부과, 안과 등

워크플로우:
----------
1. 사용자 쿼리 입력 (예: "폐렴", "열상", "당뇨병", "고혈압 문제 생성")
2. LLM 기반 쿼리 확장 (동적 의료 키워드 추가)
3. 벡터DB에서 관련 의학 지식 검색
4. 질병 매칭 점수 계산 및 텍스트 전용 모드 판단
5. LLM이 의사국가고시 스타일 문제 생성
6. LLM이 문제 내용 분석 후 적절한 이미지 타입 선택
7. 선택된 타입으로 실제 X-ray 이미지 검색 (필요시)
8. 문제 + 이미지 통합 출력

기술 스택:
---------
🤖 AI 모델: Gemini 1.5 Pro (문제 생성 + 이미지 선택 + 쿼리 확장)
🔍 벡터DB: Pinecone (의학 지식 검색)
🖼️ 이미지 임베딩: BioViL-T (의료 이미지 검색)
🎨 UI: Rich Console + matplotlib (터미널 기반 시각화)

사용 예시:
---------
```python
from generation import DynamicQuestionGenerator

# 기본 사용
generator = DynamicQuestionGenerator()
result = generator.generate_question_from_query("폐렴")

# 다중 생성
results = generator.generate_multiple_dynamic(["폐렴", "기흉", "당뇨병"])

# 품질 평가
evaluation = generator.evaluate_dynamic_quality(results)
```

CLI 사용:
---------
```bash
python main.py "폐렴"                    # 폐렴 문제 생성 (이미지 포함)
python main.py "열상 환자"               # 열상 문제 생성 (텍스트 전용)
python main.py "급성 심근경색"           # 심근경색 문제 생성 (텍스트 전용)
```

성능 특징:
---------
📈 질병 매칭 정확도: 흉부 질환 95%+ (8개 라벨)
⚡ 평균 응답 시간: 5-10초 (검색 + 생성 + 이미지 선택)
🎯 텍스트 전용 모드: 비흉부 주제 자동 감지 및 처리
🔄 확장성: 새로운 의료 분야 벡터DB 추가시 자동 지원
"""

