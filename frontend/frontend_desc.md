
# Frontend Application Analysis for Medicube

## 1. Overall Architecture

The frontend is a Single Page Application (SPA) built with vanilla JavaScript, HTML, and CSS. It is designed to interact with a **Python-based FastAPI backend**. The project structure suggests the use of Vite for development and bundling (`vite.config.js`).

The backend is responsible for implementing a **Retrieval-Augmented Generation (RAG)** pipeline. This involves:
1.  Querying a **Pinecone vector database** to find relevant medical documents and images based on the user's topic.
2.  Using the retrieved context to generate a high-quality, dynamic medical question via the **`gemini-1.5-pro` model**.
3.  Searching the vector database for images that are visually similar to the one associated with the generated question.

## 2. User Interface (UI) and User Flow

The application consists of two main views:

### Main Page (`#main-page`)
- **Purpose:** The entry point of the application where users can request a medical quiz question.
- **Components:**
    - **Topic Input:** A text field (`#medical-topic`) for users to enter a medical topic (e.g., "폐렴", "기흉").
    - **Generate Button:** A button (`#generate-btn`) to trigger the question generation process.
    - **Example Tags:** A list of preset topic buttons (`<button class="example-tag">`) for user convenience.
    - **Features Section:** A static section describing the app's key features (AI generation, image integration, detailed explanations).

### Quiz Page (`#quiz-page`)
- **Purpose:** To display the quiz, handle user interaction, and show results.
- **Components:**
    - **Loading State (`#loading-state`):** Shown while the backend performs the RAG process. It displays a multi-step loading animation reflecting the backend stages (e.g., "Searching knowledge base," "Generating with AI," "Matching images").
    - **Question Display (`#question-display`):**
        - **Image:** Displays a relevant medical image (`#question-image`) retrieved from the vector database.
        - **Question Text:** Shows the AI-generated question (`#question-text`).
        - **Options:** A list of multiple-choice options generated by the AI.
        - **Similar Images Button:** A button (`#similar-images-btn`) to open a modal with related images.
    - **Answer Display (`#answer-display`):**
        - **Correct Answer:** Shows the correct option and a detailed, AI-generated explanation (`#explanation-text`).
        - **AI Analysis:** Displays AI-inferred metadata like estimated topic, difficulty, and clinical relevance.
    - **Similar Images Modal (`#similar-images-modal`):** A popup that displays a grid of images found through a vector similarity search.
    - **Error Display (`#error-display`):** Shown if the API call fails.

### User Flow
1.  The user enters a medical topic or clicks an example tag on the main page.
2.  The user clicks the "문제 생성" (Generate Question) button.
3.  The application transitions to the quiz page and shows a loading indicator.
4.  A `POST` request is sent to the FastAPI backend at `/api/generate-question`. This triggers the full RAG pipeline.
5.  Upon receiving a successful response, the UI is populated with the AI-generated question, options, and a contextually relevant image.
6.  The user selects an option, which enables the "정답 및 해설 보기" (Show Answer and Explanation) button.
7.  Upon clicking, the correct answer is highlighted, and the AI-generated explanation becomes visible.
8.  The user can optionally click "비슷한 이미지 보기" (View Similar Images) to send a `GET` request to `/api/similar-images/:topic`, which triggers a vector similarity search in the backend.

## 3. Target API Endpoints (FastAPI Backend)

The FastAPI backend will implement the following API, which the frontend is built to consume.

### 3.1. Generate Question

- **Route:** `POST /api/generate-question`
- **Description:** Orchestrates the entire RAG process. It takes a user topic, retrieves relevant text and image data from Pinecone, and then calls the `gemini-1.5-pro` model to generate a complete quiz question object.
- **Request Body:**
  ```json
  {
      "topic": "폐렴"
  }
  ```
- **Success Response (200 OK):** The structure must match what the frontend expects.
  ```json
  {
      "question": "...",
      "options": ["...", "...", "..."],
      "answer": 1,
      "explanation": "...",
      "topic_analysis": {
          "estimated_topic": "...",
          "difficulty_level": "...",
          "clinical_relevance": "..."
      },
      "image_selection": {
          "selected_image_type": "...",
          "korean_name": "...",
          "reason": "..."
      },
      "selected_images": [
          {
              "image_path": "URL_to_image_from_DB",
              "score": 0.95,
              "labels": ["..."]
          }
      ]
  }
  ```
- **Error Response (400/500):**
  ```json
  {
      "error": "Error message detailing the failure in the RAG pipeline."
  }
  ```

### 3.2. Get Similar Images

- **Route:** `GET /api/similar-images/:topic`
- **Description:** Performs a vector-based similarity search in Pinecone to find and return images visually similar to the one associated with the given topic/question.
- **URL Parameter:**
  - `topic`: The medical topic (e.g., "폐렴"). This will be used to find the source image vector for the similarity search.
- **Success Response (200 OK):**
  ```json
  {
      "topic": "폐렴",
      "total_count": 4,
      "images": [
          {
              "id": "image_id_from_db",
              "title": "...",
              "description": "...",
              "url": "URL_to_image_from_DB",
              "similarity": 94,
              "labels": ["..."]
          }
      ]
  }
  ```
- **Error Response (500):**
  ```json
  {
      "error": "Error message detailing the failure in the image search."
  }
  ```
